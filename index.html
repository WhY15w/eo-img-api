<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0" />
    <title>EO éšæœºå›¾ç‰‡ API</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        line-height: 1.6;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 20px;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        background: rgba(255, 255, 255, 0.95);
        border-radius: 15px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        overflow: hidden;
      }

      .header {
        background: linear-gradient(45deg, #4facfe 0%, #00f2fe 100%);
        color: white;
        padding: 40px 30px;
        text-align: center;
      }

      .header h1 {
        font-size: 2.5rem;
        margin-bottom: 10px;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
      }

      .header p {
        font-size: 1.1rem;
        opacity: 0.9;
      }

      .content {
        padding: 40px 30px;
      }

      .section {
        margin-bottom: 40px;
      }

      .section h2 {
        color: #333;
        margin-bottom: 20px;
        font-size: 1.8rem;
        border-bottom: 2px solid #4facfe;
        padding-bottom: 10px;
      }

      .api-demo {
        background: #f8f9fa;
        border-radius: 10px;
        padding: 30px;
        margin-bottom: 30px;
      }

      .demo-header {
        text-align: center;
        margin-bottom: 30px;
      }

      .demo-content {
        display: flex;
        gap: 30px;
        align-items: flex-start;
        min-height: 400px;
      }

      .demo-controls {
        flex: 0 0 250px;
        display: flex;
        flex-direction: column;
        gap: 15px;
      }

      .demo-image {
        flex: 1;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
      }

      .image-container {
        position: relative;
        display: inline-block;
        border-radius: 10px;
        overflow: hidden;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        max-width: 100%;
      }

      .random-image {
        max-width: 100%;
        max-height: 500px;
        display: block;
        transition: transform 0.3s ease;
      }

      .random-image:hover {
        transform: scale(1.02);
      }

      .image-info {
        background: rgba(0, 0, 0, 0.8);
        color: white;
        padding: 10px;
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        font-size: 0.9rem;
        text-align: center;
      }

      .btn {
        background: linear-gradient(45deg, #4facfe 0%, #00f2fe 100%);
        color: white;
        border: none;
        padding: 12px 25px;
        border-radius: 25px;
        cursor: pointer;
        font-size: 1rem;
        transition: all 0.3s ease;
        box-shadow: 0 4px 15px rgba(79, 172, 254, 0.4);
        width: 100%;
      }

      .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(79, 172, 254, 0.6);
      }

      .btn:disabled {
        opacity: 0.6;
        cursor: not-allowed;
        transform: none;
      }

      .loading {
        display: none;
        text-align: center;
        padding: 40px;
      }

      .spinner {
        border: 4px solid #f3f3f3;
        border-top: 4px solid #4facfe;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        animation: spin 1s linear infinite;
        margin: 0 auto 20px;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      .api-endpoints {
        background: #f8f9fa;
        border-radius: 10px;
        padding: 25px;
      }

      .endpoint {
        background: white;
        border-radius: 8px;
        padding: 20px;
        margin-bottom: 15px;
        border-left: 4px solid #4facfe;
      }

      .endpoint h3 {
        color: #333;
        margin-bottom: 10px;
      }

      .endpoint code {
        background: #e9ecef;
        padding: 8px 12px;
        border-radius: 4px;
        font-family: "Courier New", monospace;
        color: #d63384;
        display: inline-block;
        margin: 5px 0;
      }

      .stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-top: 30px;
      }

      .stat-card {
        background: white;
        border-radius: 10px;
        padding: 25px;
        text-align: center;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        transition: transform 0.3s ease;
      }

      .stat-card:hover {
        transform: translateY(-5px);
      }

      .stat-number {
        font-size: 2rem;
        font-weight: bold;
        color: #4facfe;
        margin-bottom: 10px;
      }

      .footer {
        background: #333;
        color: white;
        text-align: center;
        padding: 20px;
      }

      /* å“åº”å¼è®¾è®¡ */
      @media (max-width: 768px) {
        .demo-content {
          flex-direction: column;
          align-items: center;
          min-height: auto;
        }

        .demo-controls {
          flex: none;
          width: 100%;
          flex-direction: row;
          justify-content: center;
          flex-wrap: wrap;
          gap: 10px;
        }

        .demo-controls .btn {
          width: auto;
          min-width: 140px;
        }

        .demo-image {
          width: 100%;
          margin-top: 20px;
        }

        .header h1 {
          font-size: 2rem;
        }

        .content {
          padding: 20px;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>ğŸ–¼ï¸ EO éšæœºå›¾ç‰‡ API</h1>
        <p>é«˜è´¨é‡éšæœºå›¾ç‰‡æœåŠ¡ - æ”¯æŒå¤šç§ç±»åˆ«å’Œæ ¼å¼</p>
      </div>

      <div class="content">
        <div class="section">
          <div class="api-demo">
            <div class="demo-header">
              <h2>ğŸ² éšæœºå›¾ç‰‡å±•ç¤º</h2>
            </div>

            <div class="demo-content">
              <div class="demo-controls">
                <button
                  class="btn"
                  onclick="loadRandomImage()">
                  è·å–éšæœºå›¾ç‰‡
                </button>
                <button
                  class="btn"
                  onclick="downloadCurrentImage()"
                  id="downloadBtn"
                  style="display: none">
                  ä¸‹è½½å›¾ç‰‡
                </button>
              </div>

              <div class="demo-image">
                <div
                  class="loading"
                  id="loading">
                  <div class="spinner"></div>
                  <p>æ­£åœ¨åŠ è½½å›¾ç‰‡...</p>
                </div>

                <div
                  class="image-container"
                  id="imageContainer"
                  style="display: none">
                  <img
                    class="random-image"
                    id="randomImage"
                    alt="éšæœºå›¾ç‰‡" />
                  <div
                    class="image-info"
                    id="imageInfo"></div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="section">
          <h2>ğŸ“– API ä½¿ç”¨è¯´æ˜</h2>
          <div class="api-endpoints">
            <div class="endpoint">
              <h3>è·å–éšæœºå›¾ç‰‡</h3>
              <p>è·å–ä¸€å¼ éšæœºå›¾ç‰‡</p>
              <code>GET /api/img?img=random</code>
              <code>GET /api/img?img=r</code>
            </div>

            <div class="endpoint">
              <h3>å“åº”å¤´ä¿¡æ¯</h3>
              <p>API ä¼šè¿”å›ä»¥ä¸‹æœ‰ç”¨çš„å¤´ä¿¡æ¯ï¼š</p>
              <div>
                <code>X-Image-Path</code> - å›¾ç‰‡è·¯å¾„<br />
                <code>X-Page</code> - é¡µé¢ç›®å½•<br />
                <code>X-Sub-Dir</code> - å­ç›®å½•ç¼–å·<br />
                <code>X-Image-Number</code> - å›¾ç‰‡ç¼–å·<br />
                <code>X-Max-Images</code> - è¯¥ç›®å½•æœ€å¤§å›¾ç‰‡æ•°
              </div>
            </div>
          </div>
        </div>

        <div class="section">
          <h2>ğŸ“Š æœåŠ¡ç»Ÿè®¡</h2>
          <div class="stats">
            <div class="stat-card">
              <div class="stat-number">5</div>
              <div>é¡µé¢ç›®å½•</div>
            </div>
            <div class="stat-card">
              <div class="stat-number">100</div>
              <div>å­ç›®å½•æ€»æ•°</div>
            </div>
            <div class="stat-card">
              <div class="stat-number">2000+</div>
              <div>å›¾ç‰‡æ€»æ•°</div>
            </div>
            <div class="stat-card">
              <div class="stat-number">JPG</div>
              <div>å›¾ç‰‡æ ¼å¼</div>
            </div>
          </div>
        </div>
      </div>

      <div class="footer">
        <p>&copy; 2025 EO éšæœºå›¾ç‰‡ API - æä¾›é«˜è´¨é‡çš„éšæœºå›¾ç‰‡æœåŠ¡</p>
      </div>
    </div>

    <script>
      let currentImageUrl = "";
      let currentImageInfo = {};

      async function loadRandomImage() {
        const loading = document.getElementById("loading");
        const imageContainer = document.getElementById("imageContainer");
        const randomImage = document.getElementById("randomImage");
        const imageInfo = document.getElementById("imageInfo");
        const downloadBtn = document.getElementById("downloadBtn");

        // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
        loading.style.display = "block";
        imageContainer.style.display = "none";
        downloadBtn.style.display = "none";

        try {
          const response = await fetch("/api/img?img=r");

          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }

          // è·å–å“åº”å¤´ä¿¡æ¯
          currentImageInfo = {
            path: response.headers.get("X-Image-Path"),
            page: response.headers.get("X-Page"),
            subDir: response.headers.get("X-Sub-Dir"),
            imageNumber: response.headers.get("X-Image-Number"),
            maxImages: response.headers.get("X-Max-Images"),
            proxyUrl: response.headers.get("X-Proxy-Url"),
          };

          // åˆ›å»ºå›¾ç‰‡ URL
          const blob = await response.blob();
          currentImageUrl = URL.createObjectURL(blob);

          // æ˜¾ç¤ºå›¾ç‰‡
          randomImage.src = currentImageUrl;
          randomImage.onload = () => {
            loading.style.display = "none";
            imageContainer.style.display = "inline-block";
            downloadBtn.style.display = "inline-block";

            // æ›´æ–°å›¾ç‰‡ä¿¡æ¯
            imageInfo.innerHTML = `
              ğŸ“ ${currentImageInfo.page}/${currentImageInfo.subDir} | 
              ğŸ–¼ï¸ ${currentImageInfo.imageNumber}/${currentImageInfo.maxImages} | 
              ğŸ“ ${randomImage.naturalWidth}Ã—${randomImage.naturalHeight}
            `;
          };
        } catch (error) {
          loading.style.display = "none";
          alert("åŠ è½½å›¾ç‰‡å¤±è´¥: " + error.message);
        }
      }

      function downloadCurrentImage() {
        if (currentImageUrl && currentImageInfo.path) {
          const a = document.createElement("a");
          a.href = currentImageUrl;
          a.download = `random-image-${currentImageInfo.page}-${currentImageInfo.subDir}-${currentImageInfo.imageNumber}.jpg`;
          document.body.appendChild(a);
          a.click();
          document.body.removeChild(a);
        }
      }

      // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨åŠ è½½ä¸€å¼ å›¾ç‰‡
      document.addEventListener("DOMContentLoaded", function () {
        loadRandomImage();
      });

      // æ”¯æŒé”®ç›˜å¿«æ·é”®
      document.addEventListener("keydown", function (e) {
        if (e.key === " " || e.key === "Enter") {
          e.preventDefault();
          loadRandomImage();
        }
      });
    </script>
  </body>
</html>
